<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Success Plan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --ink: #0f172a;
      --ink-2: #334155;
      --ink-3: #64748b;
      --teal: #14b8a6;
      --teal-600: #0d9488;
      --bg: #f8fafc;
      --card: #ffffff;
      --border: #e5e7eb;
      --radius: 8px;
      --shadow: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--ink); line-height: 1.6; }
    h1 { font-size: 32px; font-weight: 800; line-height: 1.2; letter-spacing: -0.02em; }
    h2 { font-size: 24px; font-weight: 700; line-height: 1.3; }
    h3 { font-size: 18px; font-weight: 600; line-height: 1.35; }

    .container { max-width: 1120px; margin: 0 auto; padding: 16px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .card:hover { box-shadow: var(--shadow-lg); }

    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 14px; height: 40px; font-weight: 600; border-radius: 8px; border: 1px solid transparent; cursor: pointer; transition: all .15s ease; }
    .btn:focus { outline: 2px solid var(--teal); outline-offset: 2px; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .btn-header { background: rgba(255,255,255,.12); color: #fff; border: 1px solid rgba(255,255,255,.3); }
    .btn-header:hover { background: rgba(255,255,255,.2); }
    .btn-primary { background: linear-gradient(135deg, var(--teal) 0%, var(--teal-600) 100%); color: #fff; }
    .btn-outline { background: #fff; color: var(--ink); border: 1px solid var(--border); }
    .icon { width: 20px; height: 20px; vertical-align: middle; flex-shrink: 0; }

    .pill-group { display: inline-flex; border: 1px solid var(--border); background: #f3f4f6; padding: 2px; border-radius: 8px; }
    .pill { appearance: none; position: absolute; opacity: 0; }
    .pill + label { cursor: pointer; padding: 6px 10px; font-size: 14px; font-weight: 500; color: #475569; border-radius: 6px; display: inline-flex; align-items: center; gap: 6px; }
    .pill:checked + label { background: #fff; color: var(--teal); box-shadow: 0 1px 2px rgba(0,0,0,0.06); }
    .pill:focus + label { outline: 2px solid var(--teal); outline-offset: 2px; }

    .status-pill { font-size: 12px; text-transform: uppercase; letter-spacing: .04em; padding: 4px 8px; border-radius: 9999px; font-weight: 700; }
    .status-green { background: #10b981; color: #fff; }
    .status-yellow { background: #f59e0b; color: #fff; }
    .status-red { background: #ef4444; color: #fff; }

    .kpi-value { font-size: 32px; font-weight: 700; line-height: 1; }
    .kpi-unit { font-size: 16px; color: #64748b; margin-left: 4px; }
    .kpi-delta { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 9999px; font-weight: 600; }
    .kpi-delta.positive { background: #d1fae5; color: #065f46; }
    .kpi-delta.negative { background: #fee2e2; color: #991b1b; }

    .grid { display: grid; gap: 24px; }
    .grid-main { grid-template-columns: 1fr 320px; gap: 32px; }
    @media (max-width: 1024px) { .grid-main { grid-template-columns: 1fr; } }

    @media print { html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .no-print { display: none !important; } .card, .avoid-break { break-inside: avoid; page-break-inside: avoid; } }
  </style>
</head>
<body>
  <div id="app" class="container">
    <header class="mb-8 card" style="background: linear-gradient(90deg, #0f766e, #0ea5a3); color: #fff; padding: 24px; border: none;">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-end gap-4">
        <div>
          <h1 class="flex items-baseline gap-2"><span id="customer-name-display" class="cursor-pointer" title="Click to edit">TechCorp</span><span class="opacity-90 text-[22px] font-semibold">Success Plan</span></h1>
        </div>
        <div class="flex flex-col md:flex-row items-start md:items-center gap-3">
          <p class="text-white/90 text-sm">Last updated: <span id="last-updated-date"></span></p>
          <div class="flex items-center gap-2 no-print">
            <input id="import-excel-input" class="hidden" type="file" accept=".xls,.xlsx" />
            <button id="import-excel-btn" class="btn btn-header" aria-label="Import from Excel">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v12"/><path d="M8 11l4 4 4-4"/><path d="M4 17h16v3H4z"/></svg>
              Import Excel
            </button>
            <button id="export-excel-btn" class="btn btn-header" aria-label="Export to Excel">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M8 13h8"/><path d="M8 17h8"/><path d="M8 9h4"/></svg>
              Export Excel
            </button>
            <button id="export-pdf-btn" class="btn btn-primary" aria-label="Export to PDF">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M9 15h6"/><path d="M9 11h6"/></svg>
              Export PDF
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="grid grid-main">
      <div class="space-y-6">
        <section class="card p-6 avoid-break" id="mission-summary-section">
          <h2 class="mb-3">Mission Summary</h2>
          <div id="mission-summary-display" class="text-[15px] text-slate-700"></div>
        </section>

        <section class="card p-6 avoid-break" id="mission-goals-section">
          <h2 class="mb-4">Mission Goals</h2>
          <div id="mission-goals-display" class="grid" style="grid-template-columns: repeat(2,minmax(0,1fr)); gap: 24px;"></div>
        </section>

        <section class="card p-6 avoid-break" id="value-realized-section">
          <div class="flex justify-between items-center mb-3"><h2>Value Realized</h2></div>
          <div id="value-display" class="space-y-3"></div>
        </section>

        <section class="card p-6 avoid-break" id="current-objectives">
          <div class="flex justify-between items-center mb-3"><h2>Current Objectives</h2></div>
          <div id="objectives-container" class="space-y-4"></div>
          <div id="no-objectives" class="hidden text-center py-8 text-slate-500">No active objectives.</div>
        </section>

        <section class="card p-6 avoid-break" id="past-objectives">
          <div class="flex justify-between items-center mb-3"><h2>Past Objectives Achieved</h2></div>
          <div id="past-objectives-container" class="space-y-4"></div>
          <div id="no-past-objectives" class="hidden text-center py-8 text-slate-500">Completed objectives will appear here.</div>
        </section>
      </div>

      <aside class="space-y-6">
        <section class="card p-6 avoid-break">
          <h3 class="mb-3">Overall Health</h3>
          <div class="pill-group" role="radiogroup" aria-label="Overall Health" id="health-score">
            <div class="relative"><input class="pill" type="radio" id="health-green" name="health" value="green"><label for="health-green">ðŸŸ¢ On Track</label></div>
            <div class="relative"><input class="pill" type="radio" id="health-yellow" name="health" value="yellow"><label for="health-yellow">ðŸŸ¡ Needs Attention</label></div>
            <div class="relative"><input class="pill" type="radio" id="health-red" name="health" value="red"><label for="health-red">ðŸ”´ At Risk</label></div>
          </div>
        </section>

        <section class="card p-6 avoid-break">
          <h3 class="mb-3">Key Stakeholders</h3>
          <div id="stakeholders-container" class="space-y-2"></div>
        </section>

        <section class="card p-6 avoid-break" id="products-section">
          <h3 class="mb-3">Products</h3>
          <div id="products-display" class="space-y-2"></div>
        </section>
      </aside>
    </main>
  </div>

  <script>
    const PRODUCT_KPIS = {
      'Content Library': [
        { key: 'content_utilization', label: 'Content Utilization', unit: '%', higherIsBetter: true },
        { key: 'tagging_percentage', label: 'Tagging Percentage', unit: '%', higherIsBetter: true },
        { key: 'records_with_reviews', label: '% of Records with Reviews enabled', unit: '%', higherIsBetter: true },
        { key: 'content_ownership', label: '% of content with ownership', unit: '%', higherIsBetter: true },
        { key: 'obsolete_records', label: '% of obsolete records', unit: '%', higherIsBetter: false },
        { key: 'duplicated_records', label: '% of duplicated records', unit: '%', higherIsBetter: false }
      ],
      'AI': [
        { key: 'unedited_ai_responses', label: 'Unedited AI responses', unit: '%', higherIsBetter: false },
        { key: 'answer_with_ai', label: '% answer with AI', unit: '%', higherIsBetter: true },
        { key: 'ai_chatbot_usage', label: 'AI chatbot usage', unit: 'sessions', higherIsBetter: true }
      ],
      'Projects': [
        { key: 'answer_library_usage', label: '% Answer library usage', unit: '%', higherIsBetter: true },
        { key: 'manual_answers', label: '% of manual answers', unit: '%', higherIsBetter: false },
        { key: 'answers_edited', label: '% of Answers edited from Answer Library', unit: '%', higherIsBetter: false },
        { key: 'time_per_response', label: 'Time spent per response', unit: 's', higherIsBetter: false }
      ],
      'Trust Center': [
        { key: 'profile_views', label: '% of profile views', unit: '%', higherIsBetter: true }
      ]
    };

    const state = {
      customerName: 'TechCorp',
      products: ['Content Library', 'AI'],
      missionSummary: 'Transform TechCorp\'s sales organization with Responsive\'s AI-powered platform, enabling 200+ sales reps to access the right content instantly, personalize customer interactions, and close deals 40% faster while maintaining compliance and brand consistency.',
      missionGoals: [
        { id: 1, title: 'Content Excellence Initiative', description: 'Achieve 95% content accuracy and reduce obsolete content to less than 5% through AI-powered content management and automated review workflows.' },
        { id: 2, title: 'AI Adoption Program', description: 'Drive 80% adoption of AI-powered responses across all sales teams, reducing average response time from 45 minutes to under 5 minutes.' }
      ],
      stakeholders: [
        { id: 1, name: 'Sarah Chen', title: 'VP Sales', email: 'sarah.chen@techcorp.com' },
        { id: 2, name: 'Michael Rodriguez', title: 'Sales Director', email: 'michael.r@techcorp.com' },
        { id: 3, name: 'Jennifer Park', title: 'Head of Enablement', email: 'jennifer.p@techcorp.com' }
      ],
      objectives: [
        {
          id: 1,
          name: 'Implement Content Governance Framework',
          targetDate: '2025-03-15',
          status: 'In Progress',
          description: 'Establish automated content lifecycle management with ownership assignment, review cycles, and obsolescence tracking for 5,000+ sales assets.',
          challenges: 'Legacy content lacks metadata. Need to train content owners on new tagging taxonomy.',
          nextSteps: 'Complete content audit by Feb 15. Deploy automated tagging tool by March 1.',
          kpis: [
            { id: 101, typeKey: 'content_ownership', currentValue: 62, previousValue: 15, period: 'Quarter', comparePrevious: true },
            { id: 102, typeKey: 'obsolete_records', currentValue: 18, previousValue: 32, period: 'Quarter', comparePrevious: true },
            { id: 103, typeKey: 'tagging_percentage', currentValue: 71, previousValue: 23, period: 'Month', comparePrevious: true }
          ]
        },
        {
          id: 2,
          name: 'Scale AI-Powered Responses',
          targetDate: '2025-04-30',
          status: 'Not Started',
          description: 'Roll out AI response capabilities to all 200+ sales reps with personalized training and success tracking.',
          challenges: 'Varying technical proficiency across teams. Need to customize AI models for different product lines.',
          nextSteps: 'Define success metrics. Create team-specific training paths. Set up AI performance dashboards.',
          kpis: [
            { id: 201, typeKey: 'answer_with_ai', currentValue: 34, previousValue: 8, period: 'Quarter', comparePrevious: true },
            { id: 202, typeKey: 'time_per_response', currentValue: 12, previousValue: 45, period: 'Month', comparePrevious: true }
          ]
        }
      ],
      pastObjectives: [
        {
          id: 100,
          name: 'Platform Onboarding & Initial Setup',
          targetDate: '2024-12-31',
          status: 'Completed',
          description: 'Successfully onboarded TechCorp to Responsive platform with SSO integration, initial content migration, and pilot team training.',
          challenges: 'Initial API rate limits required optimization. SSO integration needed custom SAML configuration.',
          nextSteps: 'Monitor system performance. Gather user feedback for Phase 2 rollout.',
          kpis: [ { id: 1001, typeKey: 'content_utilization', currentValue: 78, previousValue: 0, period: 'Quarter', comparePrevious: true } ]
        }
      ],
      valueRealized: [
        { id: 1, type: 'Time Savings', description: 'Sales team saves average 6 hours/week per rep through instant content discovery and AI-powered responses.', date: '2025-01-15', link: 'https://responsive.io/impact/techcorp/time-savings' },
        { id: 2, type: 'Win Rate Increase', description: 'Teams using AI-recommended content show 12% higher win rates; $2.1M additional revenue in Q1.', date: '2025-01-22', link: 'https://responsive.io/impact/techcorp/win-rate' },
        { id: 3, type: 'Cost Reduction', description: 'Reduced content creation costs by 35% via reuse and AI-assisted generation.', date: '2025-01-10', link: 'https://responsive.io/impact/techcorp/cost-savings' }
      ],
      planHealth: 'green'
    };

    const $ = (q, root = document) => root.querySelector(q);

    function getAvailableKPITypes(){const t=[];state.products.forEach(p=>{if(PRODUCT_KPIS[p])t.push(...PRODUCT_KPIS[p])});return t}
    function getKPIType(typeKey){const all=getAvailableKPITypes();return all.find(t=>t.key===typeKey)||{label:'Unknown KPI',unit:'',higherIsBetter:true}}
    function calculateDelta(current,previous){if(!previous)return 0;return ((current-previous)/Math.abs(previous)*100).toFixed(1)}
    function renderNumberBadge(n){return `<svg class="icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><circle cx="16" cy="16" r="15" fill="#e2e8f0"></circle><text x="16" y="16" fill="#0f172a" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle">${n}</text></svg>`}

    function renderMissionSummary(){const el=$('#mission-summary-display'); if(el) el.textContent=state.missionSummary||'No mission summary defined'}
    function renderMissionGoals(){const c=$('#mission-goals-display'); if(!c) return; c.innerHTML=state.missionGoals.map((g,i)=>`<div class="card p-4"><div class="flex items-center gap-3 mb-1">${renderNumberBadge(i+1)}<h3>${g.title}</h3></div><p class="text-sm text-slate-600">${g.description||''}</p></div>`).join('')}
    function renderValue(){const c=$('#value-display'); if(!c) return; c.innerHTML=state.valueRealized.map(v=>`<div class="card p-4"><div class="flex justify-between items-start"><div><h3 class="text-emerald-700">${v.type}</h3><p class="text-sm text-slate-700 mt-1">${v.description}</p><div class="text-xs text-slate-500 mt-1 flex gap-4"><span>Realized: ${v.date||'N/A'}</span>${v.link?`<a class="underline text-teal-700" href="${v.link}" target="_blank" rel="noopener">Details</a>`:''}</div></div></div></div>`).join('')}
    function renderKPI(kpi){const t=getKPIType(kpi.typeKey);const d=calculateDelta(kpi.currentValue,kpi.previousValue);const n=parseFloat(d);const pos=(t.higherIsBetter??true)?n>=0:n<=0;const show=kpi.comparePrevious&&kpi.previousValue!==undefined;const pl={'Month':'MoM','Quarter':'QoQ','Year':'YoY'}[kpi.period]||'QoQ';return `<div class="p-3 border border-slate-200 bg-slate-50"><div class="flex items-baseline gap-2"><span class="kpi-value">${kpi.currentValue}</span><span class="kpi-unit">${t.unit}</span>${show?`<span class="kpi-delta ${pos?'positive':'negative'}">${Math.abs(n)}% ${pl}</span>`:''}</div><div class="text-sm text-slate-700 mt-1">${t.label}</div></div>`}
    function renderObjectiveCard(o){const sc={'In Progress':'status-green','Not Started':'status-yellow','Completed':'status-green','At Risk':'status-red'}[o.status]||'status-yellow';return `<div class="card p-5"><div class="flex justify-between items-start mb-2"><div><h3>${o.name}</h3><div class="flex items-center gap-3 mt-1"><span class="status-pill ${sc}">${o.status}</span><span class="text-sm text-slate-500">Target: ${o.targetDate||'Not set'}</span></div></div></div><p class="text-sm text-slate-700 mb-3">${o.description||''}</p>${o.kpis?.length?`<div class="space-y-2 mb-3"><h4 class="text-sm font-semibold text-slate-700">Key Performance Indicators</h4>${o.kpis.map(k=>renderKPI(k)).join('')}</div>`:''}<div class="grid" style="grid-template-columns: repeat(2,minmax(0,1fr)); gap: 16px;"><div><span class="text-slate-600 font-medium text-sm">Challenges:</span><p class="text-sm text-slate-700 mt-1">${o.challenges||'None'}</p></div><div><span class="text-slate-600 font-medium text-sm">Next Steps:</span><p class="text-sm text-slate-700 mt-1">${o.nextSteps||'TBD'}</p></div></div></div>`}
    function renderObjectives(){const c=$('#objectives-container'); const empty=$('#no-objectives'); if(!c) return; if(!state.objectives.length){c.innerHTML=''; empty?.classList.remove('hidden')} else { empty?.classList.add('hidden'); c.innerHTML=state.objectives.map(o=>renderObjectiveCard(o)).join('') } const past=$('#past-objectives-container'); const emptyPast=$('#no-past-objectives'); if(past){past.innerHTML=state.pastObjectives.map(o=>renderObjectiveCard(o)).join('')} emptyPast?.classList.toggle('hidden', state.pastObjectives.length>0)}
    function renderStakeholders(){const c=$('#stakeholders-container'); if(!c) return; c.innerHTML=state.stakeholders.map(s=>`<div class="flex items-center justify-between p-3 bg-slate-50 border border-slate-200"><div><div class="font-semibold text-sm">${s.name}</div><div class="text-xs text-slate-600">${s.title}</div><div class="text-xs text-slate-500">${s.email}</div></div></div>`).join('')}
    function renderProducts(){const d=$('#products-display'); if(!d) return; d.innerHTML=state.products.map(p=>`<div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-teal-500"></span><span class="text-sm">${p}</span></div>`).join('')}
    function renderAll(){ document.getElementById('customer-name-display').textContent=state.customerName; document.getElementById('last-updated-date').textContent=new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}); renderMissionSummary(); renderMissionGoals(); renderValue(); renderObjectives(); renderStakeholders(); renderProducts(); const radio=document.querySelector(`input[name="health"][value="${state.planHealth}"]`); if(radio) radio.checked=true }

    async function exportToPDF(){ const btn=document.getElementById('export-pdf-btn'); btn.disabled=true; btn.innerHTML='<span class="animate-spin">âŸ³</span> Generating...'; try{ const element=document.getElementById('app'); const filename=`${(state.customerName||'customer').toLowerCase().replace(/\s+/g,'-')}-success-plan.pdf`; const opt={ filename, image:{type:'jpeg', quality:0.98}, html2canvas:{ scale:2, useCORS:true, letterRendering:true }, jsPDF:{ unit:'pt', format:'letter', compress:true }, margin:[36,36,36,36] }; await html2pdf().from(element).set(opt).save(); } catch(e){ console.error(e) } btn.disabled=false; btn.innerHTML='<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M9 15h6"/><path d="M9 11h6"/></svg>Export PDF' }
    function exportToExcel(){ try{ const wb=XLSX.utils.book_new(); const overview=[{ customer_name: state.customerName, last_updated: new Date().toISOString(), overall_health: state.planHealth }]; XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(overview), 'Overview'); const objectives=[]; const mapObj=(o,type)=>({ id:o.id, title:o.name, kpis:(o.kpis||[]).map(k=>`${getKPIType(k.typeKey).label}:${k.currentValue}${getKPIType(k.typeKey).unit}`).join('; '), owner:o.owner||'', due_date:o.targetDate||'', status:o.status, notes:[o.challenges,o.nextSteps].filter(Boolean).join(' | '), type }); state.objectives.forEach(o=>objectives.push(mapObj(o,'current'))); state.pastObjectives.forEach(o=>objectives.push(mapObj(o,'past'))); XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(objectives), 'Objectives'); const stakeholders=(state.stakeholders||[]).map(s=>({ name:s.name, role:s.title||'', email:s.email||'', influence:s.influence||'', notes:s.notes||'' })); XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(stakeholders), 'Stakeholders'); const products=(state.products||[]).map((p,i)=>({ order:i+1, product:p })); if(products.length) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(products), 'Products'); const filename=`${(state.customerName||'customer').toLowerCase().replace(/\s+/g,'-')}-success-plan.xlsx`; XLSX.writeFile(wb, filename) } catch(e){ console.error(e) } }
    async function importFromExcelFile(file){ try{ const data=await file.arrayBuffer(); const wb=XLSX.read(data,{type:'array'}); const overviewSheet=wb.Sheets['Overview']; const objectivesSheet=wb.Sheets['Objectives']; const stakeholdersSheet=wb.Sheets['Stakeholders']; const productsSheet=wb.Sheets['Products']; if(!overviewSheet||!objectivesSheet||!stakeholdersSheet){ alert('Invalid template. Required sheets: Overview, Objectives, Stakeholders.'); return } const overview=XLSX.utils.sheet_to_json(overviewSheet); const first=overview[0]||{}; const incomingName=first.customer_name||state.customerName; const incomingHealth=first.overall_health||state.planHealth; const nameChanged=incomingName&&incomingName!==state.customerName; const importedObjectives=XLSX.utils.sheet_to_json(objectivesSheet); const importedStakeholders=XLSX.utils.sheet_to_json(stakeholdersSheet); const importedProducts=productsSheet?XLSX.utils.sheet_to_json(productsSheet):[]; if(nameChanged){ state.objectives=[]; state.pastObjectives=[]; state.stakeholders=[]; state.products=[] } state.customerName=incomingName||state.customerName; state.planHealth=incomingHealth||state.planHealth; const current=[]; const past=[]; importedObjectives.forEach(row=>{ const obj={ id: row.id || Date.now()+Math.random(), name: row.title || '', targetDate: row.due_date || '', status: row.status || 'Not Started', description: '', challenges: '', nextSteps: row.notes || '', kpis: [] }; if((row.type||'').toLowerCase()==='past' || row.status==='Completed') past.push(obj); else current.push(obj) }); if(current.length) state.objectives=current; if(past.length) state.pastObjectives=past; const mappedStakeholders=importedStakeholders.map(r=>({ id: Date.now()+Math.random(), name: r.name || '', title: r.role || '', email: r.email || '', influence: r.influence || '', notes: r.notes || '' })); if(mappedStakeholders.length) state.stakeholders=mappedStakeholders; const mappedProducts=importedProducts.map(r=>r.product).filter(Boolean); if(mappedProducts.length) state.products=mappedProducts; renderAll() } catch(err){ console.error(err); alert('Import failed. Check template.') } }

    function init(){
      document.getElementById('last-updated-date').textContent = new Date().toLocaleDateString('en-US', {year:'numeric', month:'long', day:'numeric'});
      renderAll();
      document.getElementById('export-pdf-btn')?.addEventListener('click', exportToPDF);
      document.getElementById('export-excel-btn')?.addEventListener('click', exportToExcel);
      document.getElementById('import-excel-btn')?.addEventListener('click', ()=> document.getElementById('import-excel-input')?.click());
      document.getElementById('import-excel-input')?.addEventListener('change', async (e)=>{ const file=e.target.files?.[0]; if(!file) return; await importFromExcelFile(file); e.target.value=''; });
      document.getElementById('health-score')?.addEventListener('change', (e)=>{ const t=e.target; if(t && t.name==='health'){ state.planHealth=t.value; }});
    }
    init();
  </script>
</body>
</html>
